# Прыжки

В этой задаче вы должны реализовать функции для манипуляции потоком управления ([_control flow_](https://en.wikipedia.org/wiki/Control_flow), не путать с _threads_):

- `Capture(&ctx)` – захватить текущий контекст исполнения, сохранить его в переменную `ctx`
- `JumpTo(&ctx)` – прыгнуть в вызов `Capture(&ctx)`, который сохранил переданный контекст исполнения

Разобраться в поведении этих функций проще всего с помощью [тестов](tests.cpp).

Прыгать в сохраненный контекст можно только в том же вызове функции, в котором этот контекст был сохранен.

Вызовы функций `Capture` и `JumpTo` ведут себя необычно:
- Управление никогда не возвращается из вызова `JumpTo(&ctx)`
- Зато из `Capture(&ctx)` можно вернуться несколько раз: первый раз – непосредственно после вызова этой функции, а последующие – после прыжков

Можно считать, что мы хотим реализовать аналог оператора [goto](https://xkcd.com/292/): вызов `Capture` соответствует объявлению метки, а `JumpTo` – безусловному переходу.

Для решения задачи вам нужно понимать [механику стека вызовов](https://manybutfinite.com/post/journey-to-the-stack/).

---

В С и C++ существуют похожие функции – [`setjmp`](https://en.cppreference.com/w/cpp/utility/program/setjmp) / [`longjmp`](https://en.cppreference.com/w/cpp/utility/program/longjmp).

Отличие наших функций от `setjmp` / `longjmp` – мы допускаем прыжки только в пределах одного вызова функции, пересекать границы стековых фреймов во время прыжка запрещается. Подумайте, почему локальные прыжки выполнять гораздо проще.

Попробуйте придумать практичные применения нелокальным прыжкам.

---

Для решения задачи заполните определение `JumpContext` в [`jump.hpp`](jump.hpp) и реализации функций `Capture` и `JumpTo` в файле [`jump.S`](jump.S).

Проверять, что прыжки выполняются внутри одного вызова функции, не требуются. Если пользователь проигнорирует это ограничение, то получит UB.

## Полезные ссылки
- [Introduction to X86-64 Assembly for Compiler Writers](https://web.archive.org/web/20160714182232/https://www3.nd.edu/~dthain/courses/cse40243/fall2015/intel-intro.html)
- [Journey to the Stack](https://manybutfinite.com/post/journey-to-the-stack/)
- [Stack frame layout on x86-64](https://eli.thegreenplace.net/2011/09/06/stack-frame-layout-on-x86-64/)
